(this["webpackJsonpchat-client"]=this["webpackJsonpchat-client"]||[]).push([[0],{53:function(e,t,n){},70:function(e,t,n){"use strict";n.r(t);n(52),n(53);var a=n(6),s=n.n(a),r=n(42),c=n.n(r),i=n(15),o=n(16),l=n(18),u=n(17),d=n(77),h=n(22),j=n.n(h),b=n(25),p=n(43),O="accessToken",m="http://localhost:9000/login";function v(e){return Object(p.a)(e).sub}function f(){return localStorage.getItem(O)}function x(){var e=f();return e?v(e):null}function g(e,t){return y.apply(this,arguments)}function y(){return(y=Object(b.a)(j.a.mark((function e(t,n){var a,s,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(m,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:t,password:n})});case 2:if((a=e.sent).ok){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,a.json();case 7:return s=e.sent,r=s.token,localStorage.setItem(O,r),e.abrupt("return",v(r));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=n(12),k=n(81),w=n(76),C=n(79),S=n(45),L=n(1),M=N.a.from([new N.a((function(e,t){var n=f();return n&&e.setContext({headers:{authorization:"Bearer ".concat(n)}}),t(e)})),new k.a({uri:"http://localhost:9000/graphql"})]),P=new S.a({uri:"ws://localhost:9000/graphql",options:{connectionParams:function(){return{accessToken:f()}},lazy:!0,reconnect:!0}});var A,D,I,q=new w.a({cache:new C.a,link:Object(N.d)((function(e){var t=Object(L.l)(e.query);return"OperationDefinition"===t.kind&&"subscription"===t.operation}),P,M),defaultOptions:{query:{fetchPolicy:"no-cache"}}}),R=n(4),T=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).boxRef=s.a.createRef(),e}return Object(o.a)(n,[{key:"componentDidUpdate",value:function(){var e=this.boxRef.current;e.scrollTo(0,e.scrollHeight)}},{key:"render",value:function(){var e=this.props.messages;return Object(R.jsx)("div",{ref:this.boxRef,className:"box",style:{height:"50vh",overflowY:"scroll"},children:Object(R.jsx)("table",{children:Object(R.jsx)("tbody",{children:e.map(this.renderMessage.bind(this))})})})}},{key:"renderMessage",value:function(e){var t=this.props.user,n="tag";return e.from===t&&(n+=" is-primary"),Object(R.jsxs)("tr",{children:[Object(R.jsx)("td",{children:Object(R.jsx)("span",{className:n,children:e.from})}),Object(R.jsx)("td",{style:{paddingLeft:"0.75em"},children:e.text})]},e.id)}}]),n}(a.Component),J=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"handleKeyPress",value:function(e){"Enter"===e.key&&(this.props.onSend(e.target.value),e.target.value="")}},{key:"render",value:function(){return Object(R.jsx)("div",{className:"box",children:Object(R.jsx)("p",{className:"control",children:Object(R.jsx)("input",{className:"input",type:"text",placeholder:"Say something...",onKeyPress:this.handleKeyPress.bind(this)})})})}}]),n}(a.Component),K=n(49),z=n(80),B=n(82),E=n(78),$=n(29),H=n(30),Q=Object(H.a)(A||(A=Object($.a)(["\n  query MessagesQuery {\n    messages {\n      id\n      from\n      text\n    }\n  }\n"]))),U=Object(H.a)(D||(D=Object($.a)(["\n  mutation AddMessageMutation($input: MessageInput!) {\n    message: addMessage(input: $input) {\n      id\n      from\n      text\n    }\n  }\n"]))),Y=Object(H.a)(I||(I=Object($.a)(["\nsubscription {\n  messageAdded {\n    id\n    from\n    text\n  }\n}"])));var F=function(e){var t=e.user,n=function(){var e=Object(z.a)(Q).data,t=e?e.messages:[];Object(B.a)(Y,{onSubscriptionData:function(e){var n=e.client,a=e.subscriptionData;n.writeData({data:{messages:t.concat(a.data.messageAdded)}})}});var n=Object(E.a)(U),a=Object(K.a)(n,1)[0];return{messages:t,addMessage:function(e){return a({variables:{input:{text:e}}})}}}(),a=n.messages,s=n.addMessage;return Object(R.jsx)("section",{className:"section",children:Object(R.jsxs)("div",{className:"container",children:[Object(R.jsxs)("h1",{className:"title",children:["Chatting as ",t]}),Object(R.jsx)(T,{user:t,messages:a}),Object(R.jsx)(J,{onSend:s})]})})},G=n(48),V=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),r=0;r<a;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).state={name:"",password:"",error:!1},e}return Object(o.a)(n,[{key:"handleChange",value:function(e){var t=e.target,n=t.name,a=t.value;this.setState(Object(G.a)({},n,a))}},{key:"handleSubmit",value:function(){var e=Object(b.a)(j.a.mark((function e(t){var n,a,s,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n=this.state,a=n.name,s=n.password,e.next=4,g(a,s);case 4:(r=e.sent)?this.props.onLogin(r):this.setState({error:!0});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.name,n=e.password,a=e.error;return Object(R.jsx)("div",{children:Object(R.jsx)("section",{className:"section",children:Object(R.jsxs)("div",{className:"container",children:[Object(R.jsx)("h1",{className:"title",children:"Chat Login"}),Object(R.jsxs)("form",{children:[Object(R.jsxs)("div",{className:"field",children:[Object(R.jsx)("label",{className:"label",children:"Name"}),Object(R.jsx)("div",{className:"control",children:Object(R.jsx)("input",{className:"input",type:"text",name:"name",value:t,onChange:this.handleChange.bind(this)})})]}),Object(R.jsxs)("div",{className:"field",children:[Object(R.jsx)("label",{className:"label",children:"Password"}),Object(R.jsx)("div",{className:"control",children:Object(R.jsx)("input",{className:"input",type:"password",name:"password",value:n,onChange:this.handleChange.bind(this)})})]}),Object(R.jsxs)("div",{className:"field",children:[a&&Object(R.jsx)("p",{className:"help is-danger",children:"Invalid Credentials"}),Object(R.jsx)("div",{className:"control",children:Object(R.jsx)("button",{className:"button is-link",onClick:this.handleSubmit.bind(this),children:"Login"})})]})]})]})})})}}]),n}(a.Component),W=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){var e=this.props.onLogout;return Object(R.jsx)("nav",{className:"nabar",children:Object(R.jsx)("div",{className:"navbar-end",children:Object(R.jsx)("button",{className:"button navbar-item",onClick:e,children:"Logout"})})})}}]),n}(a.Component),X=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(){var e;Object(i.a)(this,n);for(var a=arguments.length,s=new Array(a),r=0;r<a;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).state={user:x()},e}return Object(o.a)(n,[{key:"handleLogin",value:function(e){this.setState({user:e})}},{key:"handleLogout",value:function(){localStorage.removeItem(O),this.setState({user:null})}},{key:"render",value:function(){var e=this.state.user;return e?Object(R.jsxs)(d.a,{client:q,children:[Object(R.jsx)(W,{onLogout:this.handleLogout.bind(this)}),Object(R.jsx)(F,{user:e})]}):Object(R.jsx)(V,{onLogin:this.handleLogin.bind(this)})}}]),n}(a.Component);c.a.render(Object(R.jsx)(X,{}),document.getElementById("root"))}},[[70,1,2]]]);
//# sourceMappingURL=main.3819f6b4.chunk.js.map